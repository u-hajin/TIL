## 목차

- 2.1 [스파크의 기본 아키텍처](#21-스파크의-기본-아키텍처)
  - 2.1.1 [스파크 애플리케이션](#211-스파크-애플리케이션)
    - [Driver](#driver)
    - [Executor](#executor)
    - [스파크 애플리케이션 이해를 위한 핵심사항](#스파크-애플리케이션-이해를-위한-핵심사항)
- 2.2 [스파크의 다양한 언어 API](#22-스파크의-다양한-언어-api)
  - [SparkSession과 스파크 언어 API 간의 관계](#sparksession과-스파크-언어-api-간의-관계)

## 2.1 스파크의 기본 아키텍처

컴퓨터 클러스터는 여러 컴퓨터의 자원을 모아 하나의 컴퓨터처럼 사용할 수 있게 만든다.  
하지만 컴퓨터 클러스터를 구성하는 것만으로는 부족하며 클러스터에서 작업을 조율할 수 있는 프레임워크인 스파크가 필요하다.

**스파크는 클러스터의 데이터 처리 작업을 관리하고 조율**한다.

스파크가 연산에 사용할 클러스터는

- 스파크 standalone
- 하둡 YARN
- Mesos

위와 같은 클러스터 매니저에서 관리한다.

### 작업 처리 과정

1. 클러스터 매니저에 스파크 애플리케이션 **submit**

2. 클러스터 매니저는 애플리케이션 실행에 필요한 **자원 할당**

3. 할당받은 자원으로 **작업 처리**

## 2.1.1 스파크 애플리케이션

스파크 애플리케이션 $\rightarrow$ dirver(드라이버) 프로세스 + 다수의 executor(익스큐터) 프로세스로 구성

### Driver

- 클러스터 노드 중 하나에서 실행됨

- main() 함수 실행

- 스파크 애플리케이션 정보 유지 관리

- 사용자 프로그램이나 입력에 대한 응답

- 전박적인 익스큐터 프로세스의 작업 관련 분석 및 배포

- 스케줄링

스파크 애플리케이션의 심장과 같은 존재로 애플리케이션의 수명 주기 동안 관련 정보를 모두 유지한다.

### Executor

- 드라이버 프로세스가 할당한 작업(코드) 실행

- 진행 상황을 드라이버 노드에 보고

아래 이미지는 클러스터 매니저가 물리적 머신을 관리하고 스파크 애플리케이션에 자원을 할당하는 방법을 나타낸다.

<img width="350" height="auto" src="https://github.com/usuyn/TIL/assets/68963707/4420468f-de96-4941-a2ea-51327438045a">

$\rightarrow$ 스파크 애플리케이션의 아키텍처

클러스터 매니저는

- 스파크 standalone
- 하둡 YARN
- Mesos

중 하나를 선택할 수 있다.

하나의 클러스터에서 여러개의 스파크 애플리케이션을 실행할 수 있다.

위 이미지에서 왼쪽에 드라이버 프로세스가 있고 오른쪽에 4개의 익스큐터가 있다. 사용자는 각 노드에 할당할 익스큐터 수를 지정할 수 있다. (이미지에는 클러스터 노드의 개념을 나타내지 않음.)

### 스파크 애플리케이션 이해를 위한 핵심사항

- 스파크는 사용 가능한 자원을 파악하기 위해 클러스터 매니저 사용

- 드라이버 프로세스는 주어진 작업 완료를 위해 드라이버 프로그램의 명령을 익스큐터에서 실행할 책임이 있다.

익스큐터는 대부분 스파크 코드를 실행하는 역할을 한다. 하지만 드라이버는 스파크의 언어 API를 통해 다양한 언어로 실행할 수 있다.

## 2.2 스파크의 다양한 언어 API

스파크의 언어 API를 이용해 다양한 프로그래밍 언어로 스파크 코드를 실행할 수 있다.  
스파크는 모든 언어에 맞는 '핵심 개념'을 제공한다. 이러한 핵심 개념은 클러스터 머신에서 실행되는 스파크 코드로 변환된다.

구조적 API만으로 작성된 코드는 언어에 상관없이 유사한 성능을 발휘한다.

- **스칼라**

  $\rightarrow$ 스파크는 스칼라로 개발되어 있으므로 스칼라가 스파크의 기본 언어이다. 책에서는 스칼라 예제를 대부분 제공한다.

- **자바**

  $\rightarrow$ 스파크 창시자들은 자바를 이용해 스파크 코드를 작성할 수 있도록 했다.

- **파이썬**

  $\rightarrow$ 스칼라가 지원하는 거의 모든 구조를 지원한다.

- **SQL**

  $\rightarrow$ 스파크는 ANSI SQL:2003 표준 중 일부를 지원한다.

- **R**

  $\rightarrow$ 스파크에는 일반적으로 사용하는 2개의 R 라이브러리가 존재한다. 하나는 스파크 코어에 포함된 SparkR이고, 다른 하나는 R 커뮤니티 기반 패키지인 sparklyr이다.

### SparkSession과 스파크 언어 API 간의 관계

<img width="450" height="auto" src="https://github.com/usuyn/TIL/assets/68963707/7d903c44-b864-4aaa-9772-4779742ae0e7">

$\rightarrow$ SparkSession과 스파크 언어 API 간의 관계

사용자는 스파크 코드를 실행하기 위해 SparkSession 객체를 진입점으로 사용할 수 있다.

스파크가 파이썬이나 R로 작성한 코드를 익스큐터의 JVM에서 실행할 수 있는 코드로 변환 $\rightarrow$ 사용자는 JVM 코드를 명시적으로 작성하지 않는다.
